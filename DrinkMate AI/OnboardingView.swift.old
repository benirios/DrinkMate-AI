//
//  OnboardingView.swift
//  DrinkMate AI
//
//  Created by BenÃ­cio Rios on 29/12/2025.
//

import SwiftUI

struct OnboardingView: View {
    @State private var currentPage = 0
    @State private var sexIndex: Int = 0
    @State private var weightKg: Double = 75
    @State private var drinkingFrequencyIndex: Int = 1 // 0=Rarely, 1=Weekly, 2=Often
    @State private var countryIndex: Int = 0
    @Binding var hasCompletedOnboarding: Bool
    @Binding var userSex: Int
    @Binding var userWeight: Double
    @Binding var userCountry: Int
    @Binding var userDrinkingFrequency: Int
    
    var body: some View {
        ZStack {
            Color(UIColor.systemBackground)
                .ignoresSafeArea()
            
            VStack(spacing: 0) {
                // Show current screen based on currentPage
                if currentPage == 0 {
                    ProblemScreen(onNext: { currentPage = 1 })
                } else if currentPage == 1 {
                    SolutionScreen(onNext: { currentPage = 2 })
                } else if currentPage == 2 {
                    UserInputScreen(
                        sexIndex: $sexIndex,
                        weightKg: $weightKg,
                        countryIndex: $countryIndex,
                        onNext: { currentPage = 3 }
                    )
                } else if currentPage == 3 {
                    DrinkingFrequencyScreen(
                        drinkingFrequencyIndex: $drinkingFrequencyIndex,
                        onComplete: {
                            userSex = sexIndex
                            userWeight = weightKg
                            userCountry = countryIndex
                            userDrinkingFrequency = drinkingFrequencyIndex
                            hasCompletedOnboarding = true
                        }
                    )
                }
            }
        }
    }
}

// MARK: - Screen 1: Problem
struct ProblemScreen: View {
    let onNext: () -> Void
    
    var body: some View {
        ZStack {
            Color(UIColor.systemBackground)
                .ignoresSafeArea()
            
            VStack(spacing: 0) {
                // Show current screen based on currentPage
                if currentPage == 0 {
                    ProblemScreen(onNext: { currentPage = 1 })
                } else if currentPage == 1 {
                    SolutionScreen(onNext: { currentPage = 2 })
                } else if currentPage == 2 {
                    UserInputScreen(
                        sexIndex: $sexIndex,
                        weightKg: $weightKg,
                        countryIndex: $countryIndex,
                        onNext: { currentPage = 3 }
                    )
                } else if currentPage == 3 {
                    DrinkingFrequencyScreen(
                        drinkingFrequencyIndex: $drinkingFrequencyIndex,
                        onComplete: {
                            userSex = sexIndex
                            userWeight = weightKg
                            userCountry = countryIndex
                            userDrinkingFrequency = drinkingFrequencyIndex
                            hasCompletedOnboarding = true
                        }
                    )
                }
            }
        }
    }
}

// MARK: - Screen 2: Solution
struct SolutionScreen: View {
    var body: some View {
        ZStack {
            Color(UIColor.systemBackground)
                .ignoresSafeArea()
            
            VStack(spacing: 0) {
                // Show current screen based on currentPage
                if currentPage == 0 {
                    ProblemScreen(onNext: { currentPage = 1 })
                } else if currentPage == 1 {
                    SolutionScreen(onNext: { currentPage = 2 })
                } else if currentPage == 2 {
                    UserInputScreen(
                        sexIndex: $sexIndex,
                        weightKg: $weightKg,
                        countryIndex: $countryIndex,
                        onNext: { currentPage = 3 }
                    )
                } else if currentPage == 3 {
                    DrinkingFrequencyScreen(
                        drinkingFrequencyIndex: $drinkingFrequencyIndex,
                        onComplete: {
                            userSex = sexIndex
                            userWeight = weightKg
                            userCountry = countryIndex
                            userDrinkingFrequency = drinkingFrequencyIndex
                            hasCompletedOnboarding = true
                        }
                    )
                }
            }
        }
    }
}

struct FeatureRow: View {
    let icon: String
    let title: String
    let description: String
    
    var body: some View {
        ZStack {
            Color(UIColor.systemBackground)
                .ignoresSafeArea()
            
            VStack(spacing: 0) {
                // Show current screen based on currentPage
                if currentPage == 0 {
                    ProblemScreen(onNext: { currentPage = 1 })
                } else if currentPage == 1 {
                    SolutionScreen(onNext: { currentPage = 2 })
                } else if currentPage == 2 {
                    UserInputScreen(
                        sexIndex: $sexIndex,
                        weightKg: $weightKg,
                        countryIndex: $countryIndex,
                        onNext: { currentPage = 3 }
                    )
                } else if currentPage == 3 {
                    DrinkingFrequencyScreen(
                        drinkingFrequencyIndex: $drinkingFrequencyIndex,
                        onComplete: {
                            userSex = sexIndex
                            userWeight = weightKg
                            userCountry = countryIndex
                            userDrinkingFrequency = drinkingFrequencyIndex
                            hasCompletedOnboarding = true
                        }
                    )
                }
            }
        }
    }
}

// MARK: - Screen 3: User Input
struct UserInputScreen: View {
    @Binding var sexIndex: Int
    @Binding var weightKg: Double
    @Binding var countryIndex: Int
    let onNext: () -> Void
    
    private let sexes = ["Male", "Female", "Other"]
    private let countries = [
        "United States", "United Kingdom", "Canada", "Australia",
        "Germany", "France", "Spain", "Italy", "Portugal", "Brazil",
        "Japan", "South Korea", "India", "Mexico", "Netherlands",
        "Belgium", "Sweden", "Norway", "Denmark", "Ireland", "Other"
    ]
    
    var body: some View {
        ZStack {
            Color(UIColor.systemBackground)
                .ignoresSafeArea()
            
            VStack(spacing: 0) {
                // Show current screen based on currentPage
                if currentPage == 0 {
                    ProblemScreen(onNext: { currentPage = 1 })
                } else if currentPage == 1 {
                    SolutionScreen(onNext: { currentPage = 2 })
                } else if currentPage == 2 {
                    UserInputScreen(
                        sexIndex: $sexIndex,
                        weightKg: $weightKg,
                        countryIndex: $countryIndex,
                        onNext: { currentPage = 3 }
                    )
                } else if currentPage == 3 {
                    DrinkingFrequencyScreen(
                        drinkingFrequencyIndex: $drinkingFrequencyIndex,
                        onComplete: {
                            userSex = sexIndex
                            userWeight = weightKg
                            userCountry = countryIndex
                            userDrinkingFrequency = drinkingFrequencyIndex
                            hasCompletedOnboarding = true
                        }
                    )
                }
            }
        }
    }
}

// MARK: - Screen 4: Drinking Frequency
struct DrinkingFrequencyScreen: View {
    @Binding var drinkingFrequencyIndex: Int
    let onComplete: () -> Void
    
    private let frequencies = ["Rarely", "Weekly", "Often"]
    private let frequencyDescriptions = [
        "A few times per year or less",
        "One or more times per week",
        "Multiple times per week or daily"
    ]
    
    var body: some View {
        ZStack {
            Color(UIColor.systemBackground)
                .ignoresSafeArea()
            
            VStack(spacing: 0) {
                // Show current screen based on currentPage
                if currentPage == 0 {
                    ProblemScreen(onNext: { currentPage = 1 })
                } else if currentPage == 1 {
                    SolutionScreen(onNext: { currentPage = 2 })
                } else if currentPage == 2 {
                    UserInputScreen(
                        sexIndex: $sexIndex,
                        weightKg: $weightKg,
                        countryIndex: $countryIndex,
                        onNext: { currentPage = 3 }
                    )
                } else if currentPage == 3 {
                    DrinkingFrequencyScreen(
                        drinkingFrequencyIndex: $drinkingFrequencyIndex,
                        onComplete: {
                            userSex = sexIndex
                            userWeight = weightKg
                            userCountry = countryIndex
                            userDrinkingFrequency = drinkingFrequencyIndex
                            hasCompletedOnboarding = true
                        }
                    )
                }
            }
        }
    }
}

// MARK: - Preview
struct OnboardingView_Previews: PreviewProvider {
    static var previews: some View {
        OnboardingView(
            hasCompletedOnboarding: .constant(false),
            userSex: .constant(0),
            userWeight: .constant(75),
            userCountry: .constant(0),
            userDrinkingFrequency: .constant(1)
        )
    }
}
